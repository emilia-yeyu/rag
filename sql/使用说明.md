# AMICRO一微半导体数据库SQL操作指南

## 📁 文件说明

- `create_tables.sql` - 数据库表结构和初始数据
- `crud_operations.sql` - 增删改查操作示例
- `run_sql.py` - SQL执行工具
- `database_manager.py` - 数据库管理器（Python API）
- `greeting_robot.db` - SQLite数据库文件

## 🚀 快速开始

### 1. 初始化数据库

```bash
cd /mnt/sda-20T/kzk/RAG/sql
python3 -c "from database_manager import DatabaseManager; DatabaseManager()"
```

### 2. 使用SQL执行工具

#### 方式一：交互模式
```bash
python3 run_sql.py
```
进入交互模式后可以直接输入SQL语句执行。

#### 方式二：执行SQL文件
```bash
python3 run_sql.py crud_operations.sql
```

#### 方式三：执行单个SQL语句
```bash
python3 run_sql.py "SELECT * FROM person_info"
```

## 📋 常用操作示例

### 查询操作

```sql
-- 查看所有人员
SELECT * FROM person_info ORDER BY name;

-- 查看所有会议
SELECT 
    m.meeting_title,
    p.name as person_name,
    m.meeting_date,
    m.start_time,
    m.location
FROM meeting_schedule m
JOIN person_info p ON m.person_id = p.id
ORDER BY m.meeting_date DESC;

-- 查询特定人员
SELECT * FROM person_info WHERE name = '肖刚军';

-- 查询今天的会议
SELECT 
    m.meeting_title,
    p.name as organizer,
    m.start_time,
    m.location
FROM meeting_schedule m
JOIN person_info p ON m.person_id = p.id
WHERE m.meeting_date = DATE('now')
ORDER BY m.start_time;
```

### 添加数据

```sql
-- 添加新人员
INSERT INTO person_info (name, title, department, office_location, bio) VALUES 
('张三', '软件工程师', 'IC研发中心', '珠海总部15楼IC研发中心', '专注于芯片软件开发');

-- 添加新会议（需要先查询person_id）
INSERT INTO meeting_schedule (person_id, meeting_title, meeting_date, start_time, end_time, location, attendees, description) VALUES 
(1, '技术讨论会', '2024-12-25', '09:00:00', '11:00:00', '法拉第会议室', '技术团队', '讨论新技术方案');
```

### 修改数据

```sql
-- 更新人员信息
UPDATE person_info 
SET title = '高级软件工程师', 
    bio = '专注于芯片软件开发，现任技术小组组长'
WHERE name = '张三';

-- 更新会议信息
UPDATE meeting_schedule 
SET location = '爱因斯坦会议室',
    start_time = '10:00:00'
WHERE id = 1;
```

### 删除数据

```sql
-- 删除会议（建议先查询确认）
DELETE FROM meeting_schedule WHERE id = 15;

-- 删除人员（会级联删除相关会议）
DELETE FROM person_info WHERE name = '张三';
```

## 🏢 会议室列表

### 14楼会议室
- 特斯拉会议室（接待专用）
- 法拉第会议室
- 黎曼会议室
- 爱迪生会议室
- 诺贝尔会议室
- 剑桥会议室
- 追求空间（洽谈室）
- 卓越空间（洽谈室）

### 15楼会议室
- 摩尔会议室
- 赫兹会议室
- 巴菲特会议室
- 高斯会议室
- 牛顿会议室
- 爱因斯坦会议室
- 乔布斯会议室
- 实干空间（洽谈室）
- 创新空间（洽谈室）
- 团队空间（洽谈室）
- 协作空间（洽谈室）
- 成就空间（洽谈室）

## 🏢 部门结构

- 总经办
- 营销一中心（家用清洁机器人业务）
- 营销二中心（芯片业务）
- 营销三中心（电子烟业务）
- 机器人研发中心
- IC研发中心
- 系统研发中心
- 机器人产品中心
- 制造中心
- 综合管理部
- 战略发展部
- 财务部
- 内审部

## 💡 使用技巧

### 1. 查询前先了解数据结构
```sql
-- 查看表结构
.schema person_info
.schema meeting_schedule

-- 查看人员ID（添加会议时需要）
SELECT id, name, title FROM person_info ORDER BY name;
```

### 2. 使用事务确保数据一致性
```sql
BEGIN TRANSACTION;
-- 执行多个相关操作
INSERT INTO person_info (...) VALUES (...);
INSERT INTO meeting_schedule (...) VALUES (...);
COMMIT;
```

### 3. 备份重要操作
```sql
-- 删除前先备份
CREATE TABLE person_info_backup AS SELECT * FROM person_info;
-- 执行删除操作
DELETE FROM person_info WHERE ...;
```

### 4. 使用别名简化查询
```sql
SELECT 
    p.name,
    m.meeting_title,
    m.meeting_date
FROM person_info p
JOIN meeting_schedule m ON p.id = m.person_id;
```

## ⚠️ 注意事项

1. **删除人员会级联删除其所有会议记录**
2. **添加会议时确保person_id存在**
3. **日期格式使用 YYYY-MM-DD**
4. **时间格式使用 HH:MM:SS**
5. **定期备份数据库文件**

## 🔧 故障排除

### 常见错误及解决方法

1. **UNIQUE constraint failed: person_info.name**
   - 原因：人员姓名重复
   - 解决：检查是否已存在同名人员

2. **FOREIGN KEY constraint failed**
   - 原因：meeting_schedule中的person_id不存在
   - 解决：先查询正确的person_id

3. **no such table: xxx**
   - 原因：数据库未初始化
   - 解决：运行create_tables.sql

## 📞 技术支持

如需帮助，请查看：
1. `crud_operations.sql` 中的示例
2. SQLite官方文档
3. 联系系统管理员
